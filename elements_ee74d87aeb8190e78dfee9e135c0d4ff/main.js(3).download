(function(){this.Blue||(this.Blue={version:{},buildDate:{}}),this.Blue.version["blue-view/main"]="2.17.0",this.Blue.buildDate["blue-view/main"]="2019-09-10T20:30:08.380Z"}).call(this),requirejs.config({paths:{d3:"d3/dist/d3","xss-filters":"xss-filters/dist/xss-filters.min"},shim:{"xss-filters":{exports:"xssFilters"}}}),define("blue-view/config",function(){}),function(e,t){function n(e,t,n){return i.yubl(t((n||i.yufull)(e)))}t.xssFilters=e,e._getPrivFilters=function(){function e(e){return e=e.split(C,2),2===e.length&&e[0]?e[0]:null}function t(e,t){return void 0===e?"undefined":null===e?"null":t.apply(e.toString(),[].splice.call(arguments,2))}function n(e,n,i,r){n=n||m,i=i||f;var o,u=[].splice.call(arguments,4);return t(e,function(){return o=this.replace(l,"\ufffd").replace(i,function(e,t,i,r){return t?(t=Number(t[0]<="9"?t:"0"+t),128===t?"\u20ac":130===t?"\u201a":131===t?"\u0192":132===t?"\u201e":133===t?"\u2026":134===t?"\u2020":135===t?"\u2021":136===t?"\u02c6":137===t?"\u2030":138===t?"\u0160":139===t?"\u2039":140===t?"\u0152":142===t?"\u017d":145===t?"\u2018":146===t?"\u2019":147===t?"\u201c":148===t?"\u201d":149===t?"\u2022":150===t?"\u2013":151===t?"\u2014":152===t?"\u02dc":153===t?"\u2122":154===t?"\u0161":155===t?"\u203a":156===t?"\u0153":158===t?"\u017e":159===t?"\u0178":t>=55296&&57343>=t||13===t?"\ufffd":a.frCoPt(t)):n[i||r]||e}),r?r.apply(o,u):o})}function i(e){return"\\"+e.charCodeAt(0).toString(16).toLowerCase()+" "}function r(e,t){return n(e,null,null,function(){return this.replace(t,i)})}function o(t,r){return n(t,null,null,function(){var t=a.yufull(this),n=e(t);return t=n&&x[n.toLowerCase()]?"##"+t:t,r?t.replace(r,i):t})}var a,u=/</g,s=/"/g,c=/'/g,l=/\x00/g,d=/(?:^(?:["'`]|\x00+$|$)|[\x09-\x0D >])/g,p=/[&<>"'`]/g,v=/(?:\x00|^-*!?>|--!?>|--?!?$|\]>|\]$)/g,f=/&(?:#([xX][0-9A-Fa-f]+|\d+);?|(Tab|NewLine|colon|semi|lpar|rpar|apos|sol|comma|excl|ast|midast|ensp|emsp|thinsp);|(nbsp|amp|AMP|lt|LT|gt|GT|quot|QUOT);?)/g,m={Tab:"\t",NewLine:"\n",colon:":",semi:";",lpar:"(",rpar:")",apos:"'",sol:"/",comma:",",excl:"!",ast:"*",midast:"*",ensp:"\u2002",emsp:"\u2003",thinsp:"\u2009",nbsp:"\xa0",amp:"&",lt:"<",gt:">",quot:'"',QUOT:'"'},g=/[^%#+\-\w\.]/g,h=/[\x01-\x1F\x7F\\"]/g,b=/[\x01-\x1F\x7F\\']/g,w=/['\(\)]/g,y=/\/\/%5[Bb]([A-Fa-f0-9:]+)%5[Dd]/,x={javascript:1,data:1,vbscript:1,mhtml:1},C=/(?::|&#[xX]0*3[aA];?|&#0*58;?|&colon;)/,V=/(?:^[\x00-\x20]+|[\t\n\r\x00]+)/g,I={Tab:"\t",NewLine:"\n"},A=String.prototype.replace,k=String.fromCodePoint||function(e){return 0===arguments.length?"":65535>=e?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),e%1024+56320))};return a={frCoPt:function(e){return!isFinite(e)||0>=e||e>1114111||e>=1&&8>=e||e>=14&&31>=e||e>=127&&159>=e||e>=64976&&65007>=e||11===e||65535==(65535&e)||65534==(65535&e)?"\ufffd":k(e)},d:n,yup:function(t){return t=e(t.replace(l,"")),t?n(t,I,null,function(){return this.replace(V,"").toLowerCase()}):null},y:function(e){return t(e,A,p,function(e){return"&"===e?"&amp;":"<"===e?"&lt;":">"===e?"&gt;":'"'===e?"&quot;":"'"===e?"&#39;":"&#96;"})},yd:function(e){return t(e,A,u,"&lt;")},yc:function(e){return t(e,A,v,function(e){return"\0"===e?"\ufffd":"--!"===e||"--"===e||"-"===e||"]"===e?e+" ":e.slice(0,-1)+" >"})},yavd:function(e){return t(e,A,s,"&quot;")},yavs:function(e){return t(e,A,c,"&#39;")},yavu:function(e){return t(e,A,d,function(e){return"\t"===e?"&#9;":"\n"===e?"&#10;":"\v"===e?"&#11;":"\f"===e?"&#12;":"\r"===e?"&#13;":" "===e?"&#32;":">"===e?"&gt;":'"'===e?"&quot;":"'"===e?"&#39;":"`"===e?"&#96;":"\ufffd"})},yu:encodeURI,yuc:encodeURIComponent,yubl:function(e){return x[a.yup(e)]?"x-"+e:e},yufull:function(e){return a.yu(e).replace(y,function(e,t){return"//["+t+"]"})},yceu:function(e){return r(e,g)},yced:function(e){return r(e,h)},yces:function(e){return r(e,b)},yceuu:function(e){return o(e,w)},yceud:function(e){return o(e)},yceus:function(e){return o(e,c)}}};var i=e._privFilters=e._getPrivFilters();e.inHTMLData=i.yd,e.inHTMLComment=i.yc,e.inSingleQuotedAttr=i.yavs,e.inDoubleQuotedAttr=i.yavd,e.inUnQuotedAttr=i.yavu,e.uriInSingleQuotedAttr=function(e){return n(e,i.yavs)},e.uriInDoubleQuotedAttr=function(e){return n(e,i.yavd)},e.uriInUnQuotedAttr=function(e){return n(e,i.yavu)},e.uriInHTMLData=i.yufull,e.uriInHTMLComment=function(e){return i.yc(i.yufull(e))},e.uriPathInSingleQuotedAttr=function(e){return n(e,i.yavs,i.yu)},e.uriPathInDoubleQuotedAttr=function(e){return n(e,i.yavd,i.yu)},e.uriPathInUnQuotedAttr=function(e){return n(e,i.yavu,i.yu)},e.uriPathInHTMLData=i.yu,e.uriPathInHTMLComment=function(e){return i.yc(i.yu(e))},e.uriQueryInSingleQuotedAttr=e.uriPathInSingleQuotedAttr,e.uriQueryInDoubleQuotedAttr=e.uriPathInDoubleQuotedAttr,e.uriQueryInUnQuotedAttr=e.uriPathInUnQuotedAttr,e.uriQueryInHTMLData=e.uriPathInHTMLData,e.uriQueryInHTMLComment=e.uriPathInHTMLComment,e.uriComponentInSingleQuotedAttr=function(e){return i.yavs(i.yuc(e))},e.uriComponentInDoubleQuotedAttr=function(e){return i.yavd(i.yuc(e))},e.uriComponentInUnQuotedAttr=function(e){return i.yavu(i.yuc(e))},e.uriComponentInHTMLData=i.yuc,e.uriComponentInHTMLComment=function(e){return i.yc(i.yuc(e))},e.uriFragmentInSingleQuotedAttr=function(e){return i.yubl(i.yavs(i.yuc(e)))},e.uriFragmentInDoubleQuotedAttr=function(e){return i.yubl(i.yavd(i.yuc(e)))},e.uriFragmentInUnQuotedAttr=function(e){return i.yubl(i.yavu(i.yuc(e)))},e.uriFragmentInHTMLData=e.uriComponentInHTMLData,e.uriFragmentInHTMLComment=e.uriComponentInHTMLComment}({},function(){return this}()),define("xss-filters",function(e){return function(){return e.xssFilters}}(this)),define("blue-view/resolver/cav",["require","blue/as/serializable","blue/is","blue/object/extend","blue/util","blue/deferred","blue/log"],function(e){"use strict";function t(e,t,n,u,c,l){var d=i.array(u)?u[0]:u.component,p=i.array(u)?u[1]:u.view,v=i.array(u)?u[2]||{}:u.options,f=l?o(l):e.viewResolverOptions||{};this.hasComponent=!d,this.hasView=!1,this.view=void 0,this.component=void 0,this.viewName=void 0,this.options=r({},s,v||{}),this.resolving=new a,this.resolved=this.resolving.promise,d&&this.setComponent(e,d,p),this.viewEngine=t,i.string(p)&&"/"!==p[0]&&d&&d.context?d.context.page.viewResolverOptions&&(f=o(d.context.page.viewResolverOptions)):i.string(p)&&"/"===p[0]&&(p=p.substr(1),f={}),p&&this.setView(e,n,p,c,f)}var n=e("blue/as/serializable"),i=e("blue/is"),r=e("blue/object/extend"),o=e("blue/util").object.deepClone,a=e("blue/deferred"),u=e("blue/log")("[blue:view]"),s={append:!1,react:!1},c=0;return t.prototype.resolve=function(){var e;if(this.isReady()){if(this.component&&this.view.viewName&&this.component._("viewName",this.view.viewName),!this.viewInternals.bridge){var t=this.component&&this.component.key?this.component.key:"EMPTY";this.viewInternals.createBridge({name:t,bindings:{},triggers:{}})}this.component&&(e=this.component.spec||{},this.viewInternals.bridge.addComponentSpecData(Object.keys(e.data||{}).reduce(function(e,t){return e[t]=1,e},{})),this.viewInternals.bridge.addComponentSpecSettings(this.component.getSettingsValues()),this.viewInternals.bridge.addComponentSpecActions(this.component.getActionNames()),this.view._componentStack=this.component.context.getStack()),this.options.viewInternals=this.viewInternals,this.resolving.resolve([this.component,this.view,this.options])}},t.prototype.reject=function(e,t){t.msg=t.message,u.error("["+e.getStack()+"]","CAV failed to resolve:",t),e.page.emit("page:error",{code:"blue:cav:error:cavResolutionFailed",description:"CAV could not be resolved:"+t}),this.resolving.reject(t)},t.prototype.setComponent=function(e,t,n){var r=this;t.oldComponent?(t.oldComponent.then(function(){r.component=t,r.component._("viewName",i.string(n)?n:""),r.hasComponent=!0,r.resolve()}).catch(function(o){o.msg=o.message,u.warn("["+e.getStack()+"]","Old Component instance "+t.key+" failed to destroy cleanly",o),r.component=t,r.component._("viewName",i.string(n)?n:""),r.hasComponent=!0,u.error("["+e.getStack()+"]","CAV component "+t.key+" failed to remove old component with same name:",o),e.page.emit("page:error",{code:"blue:cav:error:componentConstructionFailed",description:"CAV component "+t.key+" failed to remove old component with same name:"+o}),r.reject(e,o)}),delete t.oldComponent):(r.component=t,r.component._("viewName",i.string(n)?n:""),r.hasComponent=!0,r.resolve())},t.prototype.setView=function(e,t,n,r,o){var a,s,l,d=this,p=o.prefix||"",v=o.suffix||"";o=o||{},i.string(n)?(this.viewName=n,a=r+"/"+n,t[a]?(s=t[a],o={},l=e.getViewRegistry(d.viewEngine)):(s=p+n+v,l=e.getViewRegistry(d.viewEngine)),a=a+"/"+c,l.then(function(t){t.registerView(a,e.viewResolver.createId(s,o),!0)})):(this.viewName=n.name||"anonymous",a=p+this.viewName+v,l=e.getViewRegistry(d.viewEngine),l.then(function(e){e.registerView(a,n,!0)})),i.object(this.options)&&i.defined(n.targetSelector)&&!i.defined(this.options.target)&&(this.options.target=n.targetSelector),l.then(function(t){t.getView(a).then(function(t){t&&i.function(t.replaceIn)&&i.function(t.appendTo)?(d.view=t,d.viewInternals=t.link(),d.viewName&&!d.view.viewName&&(d.view.viewName=d.viewName)):u.warn("["+e.getStack()+"]","This is not a view!",t),d.hasView=!0,d.resolve()},function(t){t.msg=t.message,u.error("["+e.getStack()+"]","CAV view "+d.viewName+" failed to resolve:",t),e.page.emit("page:error",{code:"blue:cav:error:viewResolutionFailed",description:"CAV view "+d.viewName+" failed to resolve:"+t.name+":"+t.message}),d.reject(e,t)})}),c++},t.prototype.isReady=function(){return this.hasComponent&&this.hasView},n.call(t.prototype,function(){return"ComponentAndView"}),t}),define("blue-view/load",["require","blue/is","blue/resolver/module"],function(e){"use strict";var t=e("blue/is"),n=e("blue/resolver/module"),i=new n;return i.prefix="wire!",i.suffix="/pageConfig",function(e,n,r){if(!t.string(e))throw new TypeError("name must be a string");if(!t.function(n))throw new TypeError("callback must be a function");i.resolve(e).onValue(function(e){n.call(r,e)})}}),define("blue-view/nodeDictionary",["require","blue/$","blue/is","blue/store/weakMemory","blue/as/serializable","blue/log"],function(e){"use strict";function t(){this.store=new r("node")}var n=e("blue/$"),i=e("blue/is"),r=e("blue/store/weakMemory"),o=e("blue/as/serializable"),a=e("blue/log"),u=new a("[nodeDictionary]"),s=function(e){return i.array(e)?n(e[0]).get(0):n(e).get(0)};return t.prototype.hasViewAt=function(e){var t=n(e),i=t.get(0);return 1===t.length?this.store.has(i):(t.length,!1)},t.prototype.getViewAt=function(e){var t,i=n(e),r=i.get(0);if(1===i.length&&this.store.has(r))return t=this.store.get(r),t=1===t.length?t[0]:t},t.prototype.add=function(e,t){var i,r,o,a=s(e);if(!a)throw r=t.name.split(t.viewName)[0].slice(0,-1),t._componentStack&&(o=t._componentStack),u.warn('Could not create view in node "'+e+'". Node not found in DOM.'),t._destroy(),o?new Error('Could not create-view in controller "'+r+'" for component "'+o+'" in node "'+e.selector+'". Node not found in DOM.'):new Error('Could not create-view in controller "'+r+'" in node "'+e.selector+'". Node not found in DOM.');n(a).attr("data-has-view","true"),i=this.store.get(a)||[],i.push(t),this.store.set(a,i)},t.prototype.destroy=function(e){var t,i=this,r=[],o=s(e);return o?(t=i.store.get(o)||[],t.forEach(function(e){r.push(i.destroyView(e))}),Promise.all(r).then(function(){n(o).removeAttr("data-has-view"),i.store.remove(o)})):Promise.resolve()},t.prototype.destroyView=function(e){var t,i,r,o,a,s=this,c=e.viewName||"(unknown)",l=[],d=new Promise(function(e,t){r=e,o=t}),p=e.$target,v=p?p.get(0):null;return e.$element&&v&&s.store.has(v)&&s.store.get(v).indexOf(e)>-1?(i=e.$element.find("[data-has-view]"),a=i.toArray().map(function(e){var t,i=n(e),r=[],o=i&&i.length>0?i.get(0):void 0;return o&&s.store.has(o)&&(t=s.store.get(o),t.forEach(function(e){r.push(function(){return e._destroy()})}),i.removeAttr("data-has-view"),s.store.remove(o)),function(){return Promise.all(r.map(function(e){return e()}))}}).reduceRight(function(e,t){return t?e.then(t()).catch(function(e){throw e}):e},Promise.resolve()),"function"==typeof a&&(a=a()),a.then(function(){var n;v?(t=s.store.get(v))&&(1===t.length&&t[0]===e?(l.push(e._destroy()),p.removeAttr("data-has-view"),s.store.remove(v)):t.length>1&&(n=t.filter(function(t){return t!==e}),l.push(e._destroy()),s.store.set(v,n))):l.push(e._destroy()),Promise.all(l).then(function(){r()}).catch(function(e){u.error("Error encountered when destroying a top-level view "+c,e),o(e)})}).catch(function(e){throw u.error("Error encountered when destroying a nested view within "+c,e),e})):(e._destroy&&e._destroy(),r()),d},o.call(t.prototype,function(){return"NodeDictionary"}),new t}),define("blue-view/page/web",["require","blue/as/contextual","blue/as/registry","blue/util","../resolver/cav","blue/deferred","blue/dom","blue/event/channel","blue/log","blue/is","../load","../nodeDictionary","blue/queue","blue/resolver/module","blue/root","blue/siteData","blue/$"],function(t){"use strict";function n(e,t){return(e&&e.context?e.context.getStack():"")+"+"+(t?t.name:"")}var i,r=t("blue/as/contextual"),o=t("blue/as/registry"),a=t("blue/util").object.deepClone,u=t("../resolver/cav"),s=t("blue/deferred"),c=t("blue/dom"),l=t("blue/event/channel"),d=t("blue/log"),p=t("blue/is"),v=t("../load"),f=t("../nodeDictionary"),m=t("blue/queue"),g=t("blue/resolver/module"),h=t("blue/root"),b=t("blue/siteData"),w=t("blue/$"),y=d("[blue:view]"),x={},C={ractive:{path:"blue-view-ractive/view",deferred:void 0},vue:{path:"blue-view-vue/view",deferred:void 0}},V={},I=function(e,t,n){var r,o,a,u={alert:"once",when:"visible",percent:50,duration:0,event:"blue:dom:visibility",handler:function(){}},s=function(e,t){var n=t?">"+t:"",i=e,r=0;if(e.id)return"#"+e.id+n;if(!e.parentNode)return e.tagName+n;if((e.nextSibling||e.previousSibling||{}).tagName===e.tagName){for(;i=i.previousSibling;)r++;return s(e.parentNode,e.tagName+":nth-child("+r+")"+n)}return s(e.parentNode,e.tagName+n)},l=function(e,t,n){var r=i.context;e&&e.removeAttribute("trackVisibility"),r&&y.error("["+r.getStack()+"]",n+" ["+t.data+"]")},d=function(e,t,r){var o,a=n.context||{},u=a.children||[],s=u.length,c={selector:t.selector,isVisibile:t.isVisible,data:t.data};if(r)try{i.handler(c)}catch(n){l(e,t,n.message)}if(!t.default)for(;s--;)if((o=u[s].$().get(0))&&o.contains(e))return u[s].emit(t.event,c)},p=function(e,t){var n=e.getAttribute("trackVisibility")||'{"default": true}';try{n=JSON.parse(n)}catch(t){l(e,{data:e.id},"Unable to parse trackVisibility value"),n={}}return{alert:n.alert||t.alert,when:n.when||t.when,percent:Math.max(1,Math.min(100,n.percent||t.percent)),duration:Math.max(n.duration||t.duration),event:n.event||t.event,isVisible:n.isVisible||!1,selector:n.selector||s(e),data:n.data}},v=function(e){var t,n,i=e.getBoundingClientRect(),r=Math.ceil(.1*(i.bottom-i.top)),o=Math.ceil(.1*(i.right-i.left)),a=window.innerWidth||document.documentElement.clientWidth,u=window.innerHeight||document.documentElement.clientHeight,s=function(t,n){return e.contains(document.elementFromPoint(t,n))};return i.top>u||i.left>a||i.right<0||i.bottom<0||!(s(Math.max(i.left+o,0),Math.max(i.top+r,0))||s(Math.min(i.right-o,a),Math.max(i.top+r,0))||s(Math.max(i.left+o,0),Math.min(i.bottom-r,u))||s(Math.min(i.right-o,a),Math.min(i.bottom-r,u)))?0:(t=(i.bottom-i.top)*(i.right-i.left),n=(Math.min(i.bottom,u)-Math.max(i.top,0))*(Math.min(i.right,a)-Math.max(i.left,0)),Math.round(n/t*100))},f=function(e){switch(e.when){case"visible":return e.isVisible;case"hidden":return!e.isVisible}return!0},m=function(e,t){var n,r,o=p(e,i);if(!t||!V[o.selector]){if(n=o.isVisible,r=v(e),o.isVisible=r>=o.percent,o.duration&&o.isVisible){if(!n)return o.isVisible=Date.now()+o.duration,e.setAttribute("trackVisibility",JSON.stringify(o)),setTimeout(function(){m(e,t)},o.duration);if(n.constructor===Number&&n>Date.now())return}switch(o.alert){case"once":if(!f(o))return;t&&(V[o.selector]=!0),e.removeAttribute("trackVisibility");break;case"every":if(o.isVisible===n)return;if(e.setAttribute("trackVisibility",JSON.stringify(o)),!f(o)||!o.isVisible&&n.constructor===Number)return;break;default:return void l(e,o,"Invalid trackVisibility alert attribute")}d(e,o,t)}},g=function(e){e?(h.addEventListener("resize",w,!1),h.addEventListener("scroll",w,!1)):(h.removeEventListener("resize",w,!1),h.removeEventListener("scroll",w,!1)),a=e},b=function(e,t){for(var n,i=document.querySelectorAll(e),r=n=i.length;r--;)m(i[r],t);return n},w=function(){o||(o=setTimeout(function(){var e,t=Date.now(),n=(i.selector?b(i.selector,!0):0)+b("[trackVisibility]");!n&&a&&g(!1),n&&!a&&g(!0),o=void 0,(e=Date.now()-t)>50&&i.context&&y.warn("["+i.context.getStack()+"]","Visibility tracking took "+e+"ms to check "+n+" elements!")},250))},x=function(){h.MutationObserver?(r=new h.MutationObserver(w),r.observe(c,{childList:!0,subtree:!0})):h.addEventListener("DOMNodeInserted",w,!1)};!function(){n.constructor!==Object&&(n={}),Object.keys(u).forEach(function(e){e in n||(n[e]=u[e])}),n.context=e,i||x(),i=n,w()}()},A=function(){var e="",t=c.location,n=t.hash||"",i=n.replace("#","").split("/");return i.length&&i[0]?e=i[0]:h.appRoutes&&h.appRoutes[0]&&(e=h.appRoutes[0]),e},k=function(e,t,n){function i(e){if(p.defined(e)&&p.plainObject(e)&&e&&p.defined(e.actions)&&p.plainObject(e.actions)&&e.actions)for(a in e.actions)u[a]=e.actions[a]}var r,o,a,u=Object.create(null),s=!0;if(n.length){if(r=t[e.spec.name],p.defined(r)&&p.plainObject(r)&&r)for(o=0;o<n.length;o++)i(r[n[o]])}else i(e.spec);for(a in e.spec.actions)s=s&&u[a];return s&&(u[e.spec.name]=!0),u},S=function(e,t){var n=t[0]&&t[0].context&&t[0].context.viewEngine?t[0].context.viewEngine:e;return t[1]&&t[1].viewEngine&&(n=t[1].viewEngine),t[2]&&t[2].viewEngine&&(n=t[2].viewEngine),n},E=function(e,t,n){var i=t.link(),r=e.spec||{};return n=n||{},n.linkToPage=!0,i.bridge.addComponentSpecData(Object.keys(r.data||{}).reduce(function(e,t){return e[t]=1,e},{})),i.bridge.addComponentSpecSettings(e.getSettingsValues()),i.bridge.addComponentSpecActions(e.getActionNames()),n.viewInternals=i,{resolved:Promise.resolve([e,t,n])}},T=function(e){var t=e.destroy;e.destroy=function(n){return n?t.call(e):Promise.reject(new Error("Warning: Page view's component was told to destroy. This component may not be destroyed."))}},N=function(e,t){var n=this;n.name=e,n.defineContext(t,{name:e,pageName:e,logger:d("[Page-"+e+"]"),viewResolver:new g,screen:Object.create(null,{hasViewAt:{value:f.hasViewAt.bind(f),enumerable:!0},getViewAt:{value:f.getViewAt.bind(f),enumerable:!0}}),env:Object.create(t.env||null),$:w}),Object.defineProperties(n.context.site.env,{onLine:{get:function(){return h.navigator.onLine},enumerable:!0},print:{value:function(){h.print()},enumerable:!0}}),Object.defineProperties(n.context.env,{scrollToTop:{value:function(e){e?(e.scrollTop=0,e.scrollLeft=0):h.scrollTo(0,0)},enumerable:!0}}),n.tellApp=void 0,n.context.getViewRegistry=function(e){return new Promise(function(t,n){C[e]?C[e].deferred.promise.then(function(){t(C[e].registry)}):n()})},n.context.on("application:display",function(e){var t,i=[],r=e.contextStack,o=e.resolverPathOptions||a(n.context.viewResolverOptions)||{};!e.resolverPathOptions&&e.areaName&&(o.prefix=o.prefix||"",o.prefix=o.prefix+e.areaName+"/"),e.viewEngine||(e.viewEngine="ractive"),p.array(e.cavList)?p.array(e.cavList[0]||p.plainObject(e.cavList[0]))?e.cavList.forEach(function(t){var a;"PAGE"===t[1]&&t[0]?(T(t[0]),i.push(E(t[0],n.pageView,t[2]))):(a=S(e.viewEngine,t),n.loadViewEngine(a),i.push(new u(n.context,a,x,t,r,o)))},n):"PAGE"===e.cavList[1]&&e.cavList[0]?(T(e.cavList[0]),i.push(E(e.cavList[0],n.pageView,e.cavList[2]))):(t=S(e.viewEngine,e.cavList),n.loadViewEngine(t),i.push(new u(n.context,t,x,e.cavList,r,o))):p.plainObject(e.cavList)&&i.push(new u(n.context,e.viewEngine,x,e.cavList,r,o)),i.length||(n.context.emit("blue:route:viewRenderComplete",{msgType:"blue:route:viewRenderComplete",id:e.routeId,displayReqId:e.displayReqId,contextPath:e.contextStack,cavList:""}),e.resolve&&e.resolve()),n.insertComponentView(e.controllerAction,i,e.activityChannel).then(function(t){n.context.emit("blue:route:viewRenderComplete",{msgType:"blue:route:viewRenderComplete",id:e.routeId,displayReqId:e.displayReqId,contextPath:e.contextStack,cavList:t}),e.resolve&&e.resolve()},function(t){n.context.emit("blue:route:viewRenderComplete",{msgType:"blue:route:viewRenderComplete",id:e.routeId,displayReqId:e.displayReqId,contextPath:e.contextStack,cavList:""}),e.reject&&e.reject(t)})}),n.context.on("application:ready",function(){n.context.on("page:error",function(e){n.tellApp("page:error",e)}),n.context.on("blue:route:viewRenderComplete",function(e){n.tellApp(e.msgType,e)})}),n.context.on("importer:registerView",function(e){var t=e.contextStack+"/"+e.viewName;x[t]=e.viewPath})};return N.prototype=Object.create(null),N.prototype.constructor=N,N.prototype.destroy=function(){i=void 0,this.destroyContext()},N.prototype.loadViewEngine=function(e){var t=this;e&&C[e]&&(C[e].deferred||(C[e].deferred=new s,h.requirejs([C[e].path],function(n){C[e].deferred.resolve(n),o.call(C[e],"view",n,{lazy:!0,noCache:!0}),C[e].defineViewsRegistry(t.context)},function(e){context.error(e)})))},N.prototype.insertComponentView=function(t,i,r){var o,u,s,c,d,v,g=this,h=[];return u=i.map(function(e){if(e)return e.resolved}),o=Promise.all(u),s=u.length,c=new Promise(function(e,t){d=e,v=t}),o.then(function(i){var o=new m("sync");i.forEach(function(i,u){o.add(function(o){var c,m,b=i[0],m=i[1],w=i[2],x=b&&b.context||{},C={},V=function(){var e,t,i;b?b.destroyed?setTimeout(function(){f.destroyView(m)},0):(b._("enabled")&&b.disable(),w.viewInternals.bridge.enable(b.output),!b.__used&&r&&(b.__used=!0,e=b.output.asEventStream(),t=r.plug(e),e.onEnd(t)),b.enable(w.viewInternals.bridge.output)):(i=new l({eventTarget:w.viewInternals.bridge}),w.viewInternals.bridge.queueOutput=!0,w.viewInternals.bridge.enable(i)),o(),h.push(n(b,m)),u+1>=s&&d(h.join(","))};return b&&b.destroyed?(o(),h.push(n(b,m)),void(u+1>=s&&d(h.join(",")))):m&&m.destroyed?(o(),h.push(n(b,m)),void(u+1>=s&&d(h.join(",")))):(w.target?c=w.target:x.viewTargeter&&(c=x.viewTargeter.targetRequest(t,m.viewName)),void(w.linkToPage?(m.model.roles=k(b,g.roledata,g.userType),b._queueData=!0,function(){var e,t,n=b.spec||{},i=Object.keys(n.data||{}).reduce(function(e,t){return e[t]=1,e},{}),a=m.rtemplate.get();b.destroyed||(b._("enabled")&&b.disable(),Object.keys(a).forEach(function(e){i[e]&&b.model.set(e,a[e])}),w.viewInternals.bridge.reBind(b.output,i,b.getSettingsValues(),b.getActionNames()),!b.__used&&r&&(b.__used=!0,e=b.output.asEventStream(),t=r.plug(e),e.onEnd(t)),b.enable(w.viewInternals.bridge.output)),o(),u+1>=s&&d(h.join(","))}()):c?(p.plainObject(w.model)&&(m.model=g.context.util.object.mixIn(m.model,a(w.model))),b&&(Object.keys(b.spec.data||{}).forEach(function(e){C[e]=void 0}),m.model=g.context.util.object.mixIn(C,m.model,b.model.get({isolate:!0}),b.getSettingsValues()),m.model.roles=k(b,g.roledata,g.userType),b._queueData=!0),(w.append?Promise.resolve():f.destroy([c])).then(function(){w.append?m.appendTo(c,V):m.replaceIn(c,V)},function(e){throw y.error("["+g.context.getStack()+"]","View(s) in target node "+c+" failed to destroy",e),g.context.page.emit("page:error",{code:"blue:app:error:nodeDestroyFailed",description:"View(s) in target node "+c+" failed to destroy; "+e.name+":"+e.message}),e}).catch(function(e){var t=b?b.spec.name:"NONE",n=w.append?"appended":"rendered";y.error("["+g.context.getStack()+"]","CAV ("+t+":"+m.viewName+") could not be "+n+" to target "+c,e),g.context.page.emit("page:error",{code:w.append?"blue:app:error:cavAppendFailed":"blue:app:error:cavInsertFailed",description:"CAV ("+t+":"+m.viewName+") could not be "+n+" to target "+c+"; "+e.name+":"+e.message}),o(),u+1>=s&&v(e)})):(y.error("["+g.context.getStack()+"]",m.veiwName+" has no render target specified"),o(),u+1>=s&&v(e))))})})},function(e){y.error("["+g.context.getStack()+"]","CAV List could not be resolved:",e),g.context.page.emit("page:error",{code:"blue:app:error:cavListResolutionFailed",description:"CAV List could not be resolved:"+e}),v(e)}),c},N.prototype.loadSpec=function(){var e,t,n=this,i=new Promise(function(n,i){e=n,t=i});return v(A(),function(i){n.settings=i,n.roledata=i.roles||Object.create(null),n.userType=[];var r=b.getData("userType");if(p.defined(r)&&r&&(p.string(r)||p.array(r))){var o=[],a=!0;p.string(r)&&(r=[r]);for(var s=0;s<r.length;s++)p.undefined(r[s])||!r[s]||"PrimaryUser"===r[s]?a=!1:o.push(r[s]);a&&(n.userType=o)}i.viewResolverOptions&&(n.context.viewResolverOptions=i.viewResolverOptions||{}),i.viewEngine?n.view&&n.loadViewEngine(i.viewEngine):(i.viewEngine="ractive",n.view&&n.loadViewEngine("ractive")),i.context&&Object.keys(i.context).forEach(function(e){n.context[e]=i.context[e]}),w(function(){if(n.view){var r,o=n.viewTarget||"body";n.loadViewEngine(i.viewEngine),r=new u(n.context,i.viewEngine,x,[void 0,n.view,{target:o}],n.context.getStack()),r.resolved.then(function(e){n.pageView=e[1]}),n.trackVisibility&&r.resolved.then(function(){I(n.context,0,n.trackVisibility)}),n.insertComponentView("page.root",[r]).then(e,t)}else e()})}),i},N=r.call(N,{name:"page"})}),define("blue-view/mvc/mapper/mapping",["require","blue/is","blue/declare"],function(e){var t=e("blue/is");return e("blue/declare")({constructor:function(e){if(this.mapping=e,t.undefined(this.mapping))throw new TypeError('"mapping" is undefined')},lookup:function(){if(t.function(this.mapping.lookup))return this.mapping.lookup.apply(this.mapping,arguments);throw new TypeError('"mapping.lookup()" is not a function')},toString:function(){return" Mapping "}})}),define("blue-view/mvc/mapper",["require","blue/is","./mapper/mapping","blue/compose","blue/util","blue/intercept","blue/declare"],function(e){var t=e("blue/is"),n=e("./mapper/mapping"),i=e("blue/compose"),r=e("blue/util").string.trim,o=e("blue/intercept"),a=function(e){return new n(e)};return e("blue/declare")(function(){var e={constructor:function(){var e,t,n;if(arguments.length){for(e=[this],t=0;t<arguments.length;t++)e.push(arguments[t]);i.apply(i,e)}Object.defineProperty(this,"mappings",{get:function(){return n},set:function(e){n=e.map(a)},enumerable:!0}),this.defineInterceptors()},destroy:function(){this.destroyInterceptors()},mapRequest:function(){var e,n=arguments,i=!1;return this.mappings&&this.mappings.length&&this.mappings.some(function(o){return e=o.lookup.apply(o,n),t.defined(e)&&(e=e.split(",").map(r),i=e.length>0),i},this),e},toString:function(){return" Mapper "}};return o.withInterceptors.call(e,"mapRequest"),e})}),define("blue-view/mvc/targeter",["require","./mapper","blue/declare"],function(e){var t=e("./mapper");return e("blue/declare")(t,{constructor:function(){t.call(this)},targetRequest:function(e,t){return this.mapRequest(e,t)},toString:function(){return" Targeter "}})}),define("blue-view/with/domManagement",["require","blue/is"],function(e){"use strict";var t=e("blue/is");return function(){this.domManager={addClass:function(e,n,i){t.undefined(i)&&(i=n,n=void 0),e.$(n).addClass(i)},after:function(e,n,i){t.undefined(i)&&(i=n,n=void 0),e.$(n).after(i)},empty:function(e,t){e.$(t).empty()},hasClass:function(e,n,i){return t.undefined(i)&&(i=n,n=void 0),e.$(n).hasClass(i)},hide:function(e,t){e.$(t).hide()},html:function(e,n,i){t.undefined(i)&&(i=n,n=void 0),e.$(n).html(i)},prepend:function(e,n,i){t.undefined(i)&&(i=n,n=void 0),e.$(n).prepend(i)},remove:function(e,t){e.$(t).remove()},removeClass:function(e,n,i){t.undefined(i)&&(i=n,n=void 0),e.$(n).removeClass(i)},replace:function(e){var t=e.$element;e.destroyElement(),e.insertElement(function(){$(t).replaceWith(e.$element)})},show:function(e,t){e.$(t).show()}},Object.keys(this.domManager).forEach(function(e){this[e]=this.domManager[e].bind(this,this)},this)}}),define("blue-view/main",function(){});
//# sourceMappingURL=../../../../../../sourcemap/blue-view/dist/2.17.0/blue-view/js/main.js.map
